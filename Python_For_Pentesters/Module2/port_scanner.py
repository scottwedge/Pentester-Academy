import threading
import socket
import os
import time

lock = threading.Lock()
x = 6000
def connection(s,port):
    result = s.connect_ex(('127.0.0.1',port))
    if result == 0:
        print "Port found open: %d" %port

def WorkerThread():
    global x
    if x>=65535 :
        x=65535
    with lock:
        s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        for port in range(x-6000,x):
            connection(s,port)
        s.close()
        if x < 65535-6000:
            x=x+6000

start = time.time()

threads=[]

for workers in range(11):
    t = threading.Thread(target = WorkerThread)
    t.daemon = True
    t.start()
    threads.append(t)

for thread in threads:
    thread.join()

print "Time taken for full scan is %d" %(time.time()-start)
