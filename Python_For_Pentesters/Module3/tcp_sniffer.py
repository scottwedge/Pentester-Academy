import socket
import struct
import binascii

tcpSocket = socket.socket(socket.PF_PACKET,socket.SOCK_RAW,socket.htons(0x800))
#tcpSocket.setsockopt(socket.SOL_SOCKET,SO_ATTACH_FILTER, filter)
pkt = tcpSocket.recvfrom(1024)

ether_data = pkt[0][:14]
ether = struct.unpack("!6s6s2s",ether_data)
print "Mac address of the receiver is: " + binascii.hexlify(ether[0])
print "Mac address of the sender is: " + binascii.hexlify(ether[1])
print "Internet protocol type is: " + binascii.hexlify(ether[2])


ip_data = pkt[0][14:34]
ip_header = struct.unpack("!12s4s4s",ip_data)
print "Incomming ip: " + socket.inet_ntoa(ip_header[1])
print "Outgoing ip: " + socket.inet_ntoa(ip_header[2])

tcp_data = pkt[0][34:54]
tcp_header = struct.unpack("!HH16s",tcp_data)
print "Incomming port traffic is: %d" %tcp_header[0]
print "Outgoing port traffic is: %d" %tcp_header[1]
print "TCP Data: %s" %binascii.hexlify(tcp_header[2])

tcpSocket.close()
