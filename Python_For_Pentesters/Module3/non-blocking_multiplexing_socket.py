import socket,select

tcpSocket = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

tcpSocket.setsockopt(socket.SOL_SOCKET,socket.SO_REUSEADDR,1)

tcpSocket.bind(('0.0.0.0',int(argv[1])))

tcpSocket.listen(10)

Threads=[]

while True:
    read,write,ex = select.select([tcpSocket]+Threads,[],[])
    for socks in read:
        if socks is tcpSocket:
            (client,(ip,port)) = tcpSocket.accept()
            print "Received connection from IP %s on port %s " %(ip,port)
            print "Starting ECHO output"
            Threads.append(client)
        else:
            data = socks.recv(1024)
            if data == "":
                Threads.remove(socks)
                print "Closing connection"
            else:
                print "Received this from IP %s on port %s" %(ip,port)
                client.send("Client you send the server this" + data)
