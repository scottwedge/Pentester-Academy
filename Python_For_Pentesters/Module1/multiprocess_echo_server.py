import socket
import multiprocessing

def Accept_Connections(tcpSocket):
    global client
    (client,(ip,port)) = tcpSocket.accept()
    print "Connection recieved from: "+str(ip)+" from port: ",port
    return client

def Communicate(tcpSocket,client):
    data = 'dummy'
    while len(data):
        data = client.recv(2048)
        print "Client Send: "+data
        client.send(data)

if __name__ == "__main__":
    
    tcpSocket = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    tcpSocket.bind(('0.0.0.0',8000))
    tcpSocket.setsockopt(socket.SOL_SOCKET,socket.SO_REUSEADDR,1)
    tcpSocket.listen(2)

    global client    
    p1 = multiprocessing.Process(target = Accept_Connections(tcpSocket,))
    p2 = multiprocessing.Process(target = Communicate,args=(tcpSocket,client))
    
    p1.start()
    p2.start()
    
    p1.join()
    p2.join()

    print "Done!"
