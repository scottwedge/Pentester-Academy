import urllib
import sys
from bs4 import BeautifulSoup
from ip_scrapper import BypassIPFilter
import os
import requests

print "Pastebin Scrapper for Public Posts :)"
#TODO Automate the downlaod of important paste's with juicy info
if __name__ == "__main__":
    i=0
    links=[]
    while True:
        choice =  raw_input("Do you wish to Change your IP\n[Y]Yes\n[N]No\n[E]Exit program\n>>")
        if choice == "N":
            req = urllib.urlopen("https://pastebin.com/")
            if req.code == 200:
                text=req.read()
                bs = BeautifulSoup(text,"lxml")
                urls = bs.find("div",{'id':'menu_2'}).find_all('a')
                for url in urls:
                    if url['href'] not in links:
                        u = "https://pastebin.com/raw"+url['href']
                        if url.text == "Untitled":
                            filename = url.text+str(i)
                            i=i+1
                        else:
                            filename = url.text
                        print u+" : "+filename
                        links.append(u)
                        num  = int(raw_input("Do you wish to download the file : "+filename+" \n1.Yes\n2.No\n3.Dump on Screen\n>>"))
                        if num == 1:
                            urllib.urlretrieve(u,filename)
                            print "Downloaded file : "+filename
                        elif num ==3 :
                            print BeautifulSoup(requests.get(u).text,"lxml").text+"\n"
                        else:
                            pass
                    else:
                        pass
            else:
                print "IP is blocked ! Must be changed"
        elif choice == "Y" and (not choice == 'E' or not req.code == 200):
                print "IP is blocked.. Switching IP from https://free-proxy-list.net"
                BypassIPFilter()
                ip = raw_input("Select new IP to  change with\n>>")
                port = int(raw_input("Select the corrosponding port of the IP\n>>"))
                os.system('ifconfig wlan0 %s'%ip)
                print "IP Changed :)"
        elif choice == 'E':
            print "Good Bye!!!"
            sys.exit()
        else:
            print "Enter proper Choice"
        s = raw_input("Do you wish to continue\n[Y]Yes\n[N]No\n>>")
        if s == 'N':
            os.system('service network-manager restart')
            sys.exit()
